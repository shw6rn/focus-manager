{"version":3,"sources":["focusManager.min.js"],"names":["root","factory","define","amd","exports","module","focusManager","this","isAncestor","ancestor","descendant","element","parentElement","isDisabled","disabled","isFocusable","Boolean","tabIndex","makeFocusable","findFirstFocusableElement","child","focusableDescendant","children","length","i","findLastFocusableElement","focus","state","lastFocus","resolveFocus","parent","defaultFocus","focusElement","focusFirstInElement","focusLastInElement","releaseModalFocus","eventListenerContext","eventListenerArguments","removeEventListener","apply","restrictFocus","modal","focusedElement","captureModalFocus","backgroundElement","focusCallback","evnt","target","document","addEventListener","capture","release"],"mappings":"CAAE,SAASA,EAAMC,GACO,kBAAXC,SAAyBA,OAAOC,IACzCD,UAAWD,GACiB,gBAAZG,SAChBC,OAAOD,QAAUH,IAEjBD,EAAKM,aAAeL,KAEtBM,KAAM,WACR,YAEA,SAASC,GAAWC,EAAUC,GAE7B,IADA,GAAIC,GAAUD,EACPC,GAAS,CACf,GAAIA,IAAYF,EACf,OAAO,CAERE,GAAUA,EAAQC,cAGnB,OAAO,EAGR,QAASC,GAAWF,GACnB,MAAOA,GAAQG,YAAa,EAG7B,QAASC,GAAYJ,GACpB,MAAOK,SAAQL,IAAYA,EAAQM,UAAY,IAAMJ,EAAWF,GAGjE,QAASO,GAAcP,GAGlBE,EAAWF,KACdA,EAAQG,UAAW,GAGfC,EAAYJ,KAChBA,EAAQM,aAOV,QAASE,GAA0BR,GAClC,GAAII,EAAYJ,GACf,MAAOA,EAQR,KAAK,GAHDS,GACAC,EAHAC,EAAWX,EAAQW,SACnBC,EAASD,EAASC,OAIbC,EAAI,EAAGA,EAAID,EAAQC,GAAK,EAKhC,GAJAJ,EAAQE,EAASE,GAEjBH,EAAsBF,EAA0BC,GAG/C,MAAOC,EAIT,OAAO,MAMR,QAASI,GAAyBd,GAMjC,IAAK,GAHDS,GACAC,EAHAC,EAAWX,EAAQW,SACnBC,EAASD,EAASC,OAIbC,EAAID,EAAQ,EAAGC,GAAK,EAAGA,GAAK,EAKpC,GAJAJ,EAAQE,EAASE,GAEjBH,EAAsBI,EAAyBL,GAG9C,MAAOC,EAIT,OAAIN,GAAYJ,GACRA,EAGD,KAGR,QAASe,GAAMf,GACdO,EAAcP,GACdA,EAAQe,QACRC,EAAMC,UAAYjB,EAGnB,QAASkB,GAAaC,EAAQC,GAC7B,GAAIC,EAEAD,GACHC,EAAeD,GAEfC,EAAeb,EAA0BW,IAAWA,EAEhDE,IAAiBL,EAAMC,YAC1BI,EAAeP,EAAyBK,IAAWA,IAIrDJ,EAAMM,GAGP,QAASC,GAAoBtB,GAC5B,GAAIqB,GAAeb,EAA0BR,IAAYA,CACzDe,GAAMM,GAGP,QAASE,GAAmBvB,GAC3B,GAAIqB,GAAeP,EAAyBd,IAAYA,CACxDe,GAAMM,GAWP,QAASG,GAAkBH,GAC1B,GAAII,GAAuBT,EAAMS,qBAC7BC,EAAyBV,EAAMU,sBAE/BD,IAAwBC,GAC3BD,EAAqBE,oBAAoBC,MAAMH,EAAsBC,GAItEV,EAAMS,qBAAuB,KAC7BT,EAAMU,uBAAyB,KAC/BV,EAAMC,UAAY,KAEdI,GACHA,EAAaN,QAKf,QAASc,GAAcC,EAAOC,GACzBlC,EAAWiC,EAAOC,GACrBf,EAAMC,UAAYc,EAElBb,EAAaY,GAOf,QAASE,GAAkBF,EAAOT,EAAcY,GAc/C,QAASC,GAAcC,GACtBN,EAAcC,EAAOK,EAAKC,QAZ3B,IAAKN,EACJ,MAAO,KAIRN,KAGAN,EAAaY,EAAOT,EAUpB,IAAII,GAAuBQ,GAAqBI,SAC5CX,GAA0B,QAASQ,GAAe,EAItDlB,GAAMS,qBAAuBA,EAC7BT,EAAMU,uBAAyBA,EAE/BD,EAAqBa,iBAAiBV,MAAMH,EAAsBC,GAjEnE,GAAIV,IACHU,uBAAwB,KACxBD,qBAAsB,KACtBR,UAAW,MAiERtB,GACH4C,QAASP,EACTQ,QAAShB,EACTF,oBAAqBA,EACrBC,mBAAoBA,EAErB,OAAO5B","file":"focusManager.min.js","sourcesContent":[";(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define([], factory);\n  } else if (typeof exports === 'object') {\n    module.exports = factory();\n  } else {\n    root.focusManager = factory();\n  }\n}(this, function() {\n\"use strict\";\r\n\r\nfunction isAncestor(ancestor, descendant) {\r\n\tvar element = descendant;\r\n\twhile (element) {\r\n\t\tif (element === ancestor) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\telement = element.parentElement;\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n\r\nfunction isDisabled(element) {\r\n\treturn element.disabled === true;\r\n}\r\n\r\nfunction isFocusable(element) {\r\n\treturn Boolean(element) && element.tabIndex >= 0 && !isDisabled(element);\r\n}\r\n\r\nfunction makeFocusable(element) {\r\n\t// A tabIndex is needed to make the element focusable\r\n\t// A tabIndex of -1 means that the element is only programmatically focusable\r\n\tif (isDisabled(element)) {\r\n\t\telement.disabled = false;\r\n\t}\r\n\r\n\tif (!isFocusable(element)) {\r\n\t\telement.tabIndex = -1;\r\n\t}\r\n}\r\n\r\n// Find the first focusable element.\r\n// The candidates are the element and it's descendants.\r\n// The search is performed depth-first.\r\nfunction findFirstFocusableElement(element) {\r\n\tif (isFocusable(element)) {\r\n\t\treturn element;\r\n\t}\r\n\r\n\tvar children = element.children;\r\n\tvar length = children.length;\r\n\tvar child;\r\n\tvar focusableDescendant;\r\n\r\n\tfor (var i = 0; i < length; i += 1) {\r\n\t\tchild = children[i];\r\n\r\n\t\tfocusableDescendant = findFirstFocusableElement(child);\r\n\r\n\t\tif (focusableDescendant) {\r\n\t\t\treturn focusableDescendant;\r\n\t\t}\r\n\t}\r\n\r\n\treturn null;\r\n}\r\n\r\n// Find the first focusable element.\r\n// The candidates are the element and it's descendants.\r\n// The search is performed depth-first.\r\nfunction findLastFocusableElement(element) {\r\n\tvar children = element.children;\r\n\tvar length = children.length;\r\n\tvar child;\r\n\tvar focusableDescendant;\r\n\r\n\tfor (var i = length -1; i >= 0; i -= 1) {\r\n\t\tchild = children[i];\r\n\r\n\t\tfocusableDescendant = findLastFocusableElement(child);\r\n\r\n\t\tif (focusableDescendant) {\r\n\t\t\treturn focusableDescendant;\r\n\t\t}\r\n\t}\r\n\r\n\tif (isFocusable(element)) {\r\n\t\treturn element;\r\n\t}\r\n\r\n\treturn null;\r\n}\r\n\r\nfunction focus(element) {\r\n\tmakeFocusable(element);\r\n\telement.focus();\r\n\tstate.lastFocus = element;\r\n}\r\n\r\nfunction resolveFocus(parent, defaultFocus) {\r\n\tvar focusElement;\r\n\r\n\tif (defaultFocus) {\r\n\t\tfocusElement = defaultFocus;\r\n\t} else {\r\n\t\tfocusElement = findFirstFocusableElement(parent) || parent;\r\n\r\n\t\tif (focusElement === state.lastFocus) {\r\n\t\t\tfocusElement = findLastFocusableElement(parent) || parent;\r\n\t\t}\r\n\t}\r\n\r\n\tfocus(focusElement);\r\n}\r\n\r\nfunction focusFirstInElement(element) {\r\n\tvar focusElement = findFirstFocusableElement(element) || element;\r\n\tfocus(focusElement);\r\n}\r\n\r\nfunction focusLastInElement(element) {\r\n\tvar focusElement = findLastFocusableElement(element) || element;\r\n\tfocus(focusElement);\r\n}\r\n\r\n// State is kept is these variables.\r\n// Since only one modal dialog can capture focus at a time the state is a singleton.\r\nvar state = {\r\n\teventListenerArguments: null,\r\n\teventListenerContext: null,\r\n\tlastFocus: null\r\n};\r\n\r\nfunction releaseModalFocus(focusElement) {\r\n\tvar eventListenerContext = state.eventListenerContext;\r\n\tvar eventListenerArguments = state.eventListenerArguments;\r\n\r\n\tif (eventListenerContext && eventListenerArguments) {\r\n\t\teventListenerContext.removeEventListener.apply(eventListenerContext, eventListenerArguments);\r\n\t}\r\n\r\n\t// Reset the state object\r\n\tstate.eventListenerContext = null;\r\n\tstate.eventListenerArguments = null;\r\n\tstate.lastFocus = null;\r\n\r\n\tif (focusElement) {\r\n\t\tfocusElement.focus();\r\n\t}\r\n}\r\n\r\n// Keep focus inside the modal\r\nfunction restrictFocus(modal, focusedElement) {\r\n\tif (isAncestor(modal, focusedElement)) {\r\n\t\tstate.lastFocus = focusedElement;\r\n\t} else {\r\n\t\tresolveFocus(modal);\r\n\t}\r\n}\r\n\r\n// modal, the element in which to contain focus\r\n// focusElement (optional), the element inside the modal to focus when opening\r\n// backgroundElement (optional), All focus events within this element are redirected to the modal. Defaults to document\r\nfunction captureModalFocus(modal, focusElement, backgroundElement) {\r\n\r\n\t// without a modal there is nothing to capture\r\n\tif (!modal) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\t// If any focus is already being captured, release it now\r\n\treleaseModalFocus();\r\n\r\n\t// focus the modal so the user knows it was opened\r\n\tresolveFocus(modal, focusElement);\r\n\r\n\t// Whenever an element outside of the modal is focused, the modal is focused instead\r\n\tfunction focusCallback(evnt) {\r\n\t\trestrictFocus(modal, evnt.target);\r\n\t}\r\n\r\n\t// The focus event does not bubble\r\n\t// however it can be captured on an ancestor element\r\n\t// by setting useCapture to true\r\n\tvar eventListenerContext = backgroundElement || document;\r\n\tvar eventListenerArguments = [\"focus\", focusCallback, true];\r\n\r\n\t// Save the eventListener data in the state object so it can be removed later\r\n\t// by the releaseModalFocus function\r\n\tstate.eventListenerContext = eventListenerContext;\r\n\tstate.eventListenerArguments = eventListenerArguments;\r\n\r\n\teventListenerContext.addEventListener.apply(eventListenerContext, eventListenerArguments);\r\n}\r\n\r\nvar focusManager = {\r\n\tcapture: captureModalFocus,\r\n\trelease: releaseModalFocus,\r\n\tfocusFirstInElement: focusFirstInElement,\r\n\tfocusLastInElement: focusLastInElement\r\n};\nreturn focusManager;\n}));\n"],"sourceRoot":"/source/"}